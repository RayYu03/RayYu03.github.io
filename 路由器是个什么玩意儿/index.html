<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta name="google-site-verification" content="Y9Y8jlcM-PScY-2hDiBCdLu1omnFeLU2SiugUCAOAHY" />
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="计算机网络,路由器," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="路由器（英语：Router，又称路径器）是一种电讯网络设备，提供路由与转送两种重要机制，可以决定数据包从来源端到目的端所经过的路由路径（host到host之间的传输路径），这个过程称为路由；将路由器输入端的数据包移送至适当的路由器输出端（在路由器内部进行），这称为转送。路由工作在OSI模型的第三层——即网络层，例如网际协议（IP）。">
<meta property="og:type" content="article">
<meta property="og:title" content="路由器是个什么玩意儿?">
<meta property="og:url" content="http://tiierr.xyz/路由器是个什么玩意儿/index.html">
<meta property="og:site_name" content="你今天真好看">
<meta property="og:description" content="路由器（英语：Router，又称路径器）是一种电讯网络设备，提供路由与转送两种重要机制，可以决定数据包从来源端到目的端所经过的路由路径（host到host之间的传输路径），这个过程称为路由；将路由器输入端的数据包移送至适当的路由器输出端（在路由器内部进行），这称为转送。路由工作在OSI模型的第三层——即网络层，例如网际协议（IP）。">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/647dc635jw1f9heryh1wyj20q60f6n1o.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/647dc635jw1f9hgced3w5j20v70k2jvm.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/647dc635jw1f9hg12u68qj20om08ywga.jpg">
<meta property="og:image" content="https://ws3.sinaimg.cn/large/647dc635jw1f9hg1f3ssnj20pb090jt7.jpg">
<meta property="og:updated_time" content="2017-01-12T10:55:58.519Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="路由器是个什么玩意儿?">
<meta name="twitter:description" content="路由器（英语：Router，又称路径器）是一种电讯网络设备，提供路由与转送两种重要机制，可以决定数据包从来源端到目的端所经过的路由路径（host到host之间的传输路径），这个过程称为路由；将路由器输入端的数据包移送至适当的路由器输出端（在路由器内部进行），这称为转送。路由工作在OSI模型的第三层——即网络层，例如网际协议（IP）。">
<meta name="twitter:image" content="https://ws3.sinaimg.cn/large/647dc635jw1f9heryh1wyj20q60f6n1o.jpg">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> 路由器是个什么玩意儿? | 你今天真好看 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">你今天真好看</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                路由器是个什么玩意儿?
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-11-05T18:20:54+08:00" content="2016-11-05">
              2016-11-05
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/路由器是个什么玩意儿/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="路由器是个什么玩意儿/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://zh.wikipedia.org/wiki/%E8%B7%AF%E7%94%B1%E5%99%A8" target="_blank" rel="external">路由器</a>（英语：Router，又称路径器）是一种电讯网络设备，提供<a href="https://zh.wikipedia.org/wiki/%E8%B7%AF%E7%94%B1" target="_blank" rel="external">路由</a>与转送两种重要机制，可以决定数据包从来源端到目的端所经过的路由路径（host到host之间的传输路径），这个过程称为路由；将路由器输入端的数据包移送至适当的路由器输出端（在路由器内部进行），这称为转送。路由工作在<a href="https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B" target="_blank" rel="external">OSI模型</a>的第三层——即网络层，例如<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AE" target="_blank" rel="external">网际协议</a>（IP）。<br><a id="more"></a></p>
<h1 id="路由器的结构"><a href="#路由器的结构" class="headerlink" title="路由器的结构"></a>路由器的结构</h1><p><code>路由器</code>是一种具有多个输入端口和多个输出端口的专用计算机,其任务是转发分组。也就是说,将路由器某个输入端口收到的分组,按照分组要去的目的地(即<code>目的网络</code>),把该分组从路由器的某个合适的输出端口转发给下一跳的路由器。</p>
<p>下一跳的路由器也按照这种方法处理分组,直到该分组到达终点为止。</p>
<p><img src="https://ws3.sinaimg.cn/large/647dc635jw1f9heryh1wyj20q60f6n1o.jpg" alt="典型的路由器的结构"></p>
<p>由上图可以看出,整个路由器的结构可划分为2个部分:</p>
<ul>
<li><code>路由选择部分</code></li>
<li><code>分组转发部分</code></li>
</ul>
<h1 id="路由选择部分"><a href="#路由选择部分" class="headerlink" title="路由选择部分"></a>路由选择部分</h1><p><code>路由选择部分</code>也叫做<code>控制部分</code>,其核心构建是<code>路由选择处理机</code>。</p>
<h2 id="路由选择处理机"><a href="#路由选择处理机" class="headerlink" title="路由选择处理机"></a>路由选择处理机</h2><p>路由选择处理机的主要任务是根据所选定的路由选择协议(RIP/OSPF），构造、更新、维护路由表。关于怎样根据路由选择协议构造和更新路由表,我们将在后面讨论。</p>
<h1 id="分组转发部分"><a href="#分组转发部分" class="headerlink" title="分组转发部分"></a>分组转发部分</h1><p>分组转发部分分为:</p>
<ul>
<li><code>交换结构</code></li>
<li><code>输入端口</code></li>
<li><code>输出端口</code></li>
</ul>
<h2 id="交换结构"><a href="#交换结构" class="headerlink" title="交换结构"></a>交换结构</h2><p>交换结构(switching fabric):</p>
<blockquote>
<p>Switched Fabric or switching fabric is a network topology in which network nodes interconnect via one or more network switches (particularly crossbar switches). Because a switched fabric network spreads network traffic across multiple physical links, it yields higher total throughput than broadcast networks, such as the early 10BASE5 version of Ethernet, or most wireless networks such as Wi-Fi.<br><a href="https://en.wikipedia.org/wiki/Switched_fabric" target="_blank" rel="external">&gt;&gt; wikipedia</a></p>
</blockquote>
<p>交换结构又称为交换组织,它的作用就是根据转发表(<a href="https://en.wikipedia.org/wiki/Forwarding_information_base" target="_blank" rel="external">forwarding table</a>)对分组进行处理,将某个输入端口进入的分组从一个合适的输出端口转发出去。交换结构本身就是一种网络,但这种网络完全包含在路由器中,因此交换结构又可看成是”在路由器中的网络”。</p>
<p>实现这样的交换有多种方法,下图给出了三种常见的交换方法。</p>
<ul>
<li>通过存储器</li>
<li>通过总线</li>
<li>通过互连网络</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/647dc635jw1f9hgced3w5j20v70k2jvm.jpg" alt="三种常见的交换方法"></p>
<p>这三种方法都是将输出端口I1收到的分组转发到输出端口O2。</p>
<h3 id="通过存储器"><a href="#通过存储器" class="headerlink" title="通过存储器"></a>通过存储器</h3><p>上图中(a)的示意图表示分组通过存储器进行交换。<br>与早期路由器的区别就是,目的地址的查找与分组在存储器中的缓存都是在输入端口中进行的。</p>
<h3 id="通过总线"><a href="#通过总线" class="headerlink" title="通过总线"></a>通过总线</h3><p>上图中(b)的示意图表示分组通过总线进行交换。<br>采用这种方式时,数据报从输入端口通过共享的总线直接传送到合适的输出端口,而不需要路由选择处理机的干预。但是,由于总线是共享的,因此在同一时间只能有一个分组在总线上传送。当分组到达输入端口时若发现总线忙,则被阻塞而不能通过交换结构,并在输入端口排队等待。因为每一个要转发的分组都要通过每一条总线,因此路由器的转发带宽就受总线效率的限制。</p>
<h3 id="通过互连网络"><a href="#通过互连网络" class="headerlink" title="通过互连网络"></a>通过互连网络</h3><p>上图中(c)的示意图表示分组通过纵横交换结构进行交换。这种交换结构常称为互连网络。<br>它有2N条总线,可以使N个输入端口和N个输出端口相连接,这取决于相应的交叉节点是使水平总线和垂直总线接通还是断开。<br>当输入端口收到一个分组时,就将它发送到与该输入端口相连的水平总线上。若通向所要转发的输出端口的垂直总线是空闲的,则在这个结点将垂直总线与水平总线接通,然后将该分组转发到这个输出端口。但若该垂直总线已被占用,则后到达的分组就被阻塞,必须在输入端口排队。</p>
<h3 id="转发和路由选择的区别"><a href="#转发和路由选择的区别" class="headerlink" title="转发和路由选择的区别"></a>转发和路由选择的区别</h3><p><code>转发(forwarding)</code>(只涉及一个路由器) 就是路由器根据转发表将用户的 <code>IP 数据报</code>从合适的端口转发出去。</p>
<p><code>路由选择(routing)</code>(涉及整个网络的很多路由器)则是按照分布式算法,根据从各相邻路由器得到的关于网络拓扑的变化情况,动态地改变所选择的路由。</p>
<p><code>路由表</code>（目的网络N，距离d，下一跳地址A）和<code>转发表</code>（下一跳地址X，对应物理地址HA）的项目内容和完成的功能也不相同。路由表是根据路由选择算法得出的。而转发表是从路由表得出的。<br>对<code>路由交换信息分组</code>（如<code>RIP</code>/<code>OSPF</code>分组，由路由选择处理机来处理）和<code>数据分组</code>（由交换结构来处理）也是采取不同的处理方式。</p>
<p>在讨论<code>路由选择</code>的原理时,往往不去区分转发表和路由表的区别。</p>
<h2 id="输入端口和输出端口"><a href="#输入端口和输出端口" class="headerlink" title="输入端口和输出端口"></a>输入端口和输出端口</h2><p>在上图中,路由器的输入和输出端口里面都各有三个方框,用方框中的1,2和3分别表示<code>物理层</code>,<code>数据链路层</code>和<code>网络层</code>的处理模块。</p>
<h3 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h3><p>物理层进行比特的接收。</p>
<h3 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h3><p>数据链路层按照链路层协议接收传送分组的帧。在把帧的首部和尾部都剥去后,分组就被送入网络层进行处理。</p>
<h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><p>若接收到的分组是路由器之间交换路由信息的分组(如 <code>RIP</code> 或 <code>OSPF</code> 分组等),则把这种分组送交到路由器的路由选择部分中的路由选择处理机。</p>
<p>若接收到的是数据分组,则按照分组首部中的目的地址查找转发表,根据得出的结果,分组就经过交换结构到达合适的输出端口。</p>
<h3 id="输入端口对线路上收到分组的处理"><a href="#输入端口对线路上收到分组的处理" class="headerlink" title="输入端口对线路上收到分组的处理"></a>输入端口对线路上收到分组的处理</h3><p>数据链路层剥去帧首部和尾部后,将分组送到网络层的队列中进行排队等待处理。当一个分组正在查找转发表,后面又跟着从这个输入端口收到的另一个分组,这个后到的分组就必须在队列中等待,这会产生一定的时延。</p>
<p><img src="https://ws3.sinaimg.cn/large/647dc635jw1f9hg12u68qj20om08ywga.jpg" alt="输入端口对线路上收到分组的处理"></p>
<h3 id="输出端口对线路上收到分组的处理"><a href="#输出端口对线路上收到分组的处理" class="headerlink" title="输出端口对线路上收到分组的处理"></a>输出端口对线路上收到分组的处理</h3><p>当交换结构传送过来的分组先进行缓存。在网络层的处理模块中设有一个缓冲区,实际上它就是一个队列。当交换结构传送过来的分组的速率超过输出链路的发送速率时,来不及发送的分组就必须暂时存放在这个队列中。数据链路层处理模块将分组加上链路层的首部和尾部,交给物理层后发送到外部线路。</p>
<p><img src="https://ws3.sinaimg.cn/large/647dc635jw1f9hg1f3ssnj20pb090jt7.jpg" alt="输出端口对线路上收到分组的处理"></p>
<h3 id="分组丢弃"><a href="#分组丢弃" class="headerlink" title="分组丢弃"></a>分组丢弃</h3><p>若路由器处理分组的速率赶不上分组进入队列的速率,则队列的存储空间最终必定减少到零,这就使后面再进入队列的分组由于没有存储空间而只能被丢弃。<br>路由器中的输入或输出队列产生<code>溢出</code>是造成分组丢失的重要原因。</p>

      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/计算机网络/" rel="tag">#计算机网络</a>
          
            <a href="/tags/路由器/" rel="tag">#路由器</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/linux-reviews/" rel="next" title="linux reviews">
                <i class="fa fa-chevron-left"></i> linux reviews
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/计算机网络之运输层的碎碎念/" rel="prev" title="计算机网络之运输层的碎碎念">
                计算机网络之运输层的碎碎念 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="路由器是个什么玩意儿/"
           data-title="路由器是个什么玩意儿?" data-url="http://tiierr.xyz/路由器是个什么玩意儿/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ww1.sinaimg.cn/large/647dc635jw1f37ldgc9isj20ia0jn795.jpg"
               alt="Ray Yu" />
          <p class="site-author-name" itemprop="name">Ray Yu</p>
          <p class="site-description motion-element" itemprop="description">不为无益之事，何以遣有涯至生？</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">69</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">39</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#路由器的结构"><span class="nav-number">1.</span> <span class="nav-text">路由器的结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#路由选择部分"><span class="nav-number">2.</span> <span class="nav-text">路由选择部分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#路由选择处理机"><span class="nav-number">2.1.</span> <span class="nav-text">路由选择处理机</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#分组转发部分"><span class="nav-number">3.</span> <span class="nav-text">分组转发部分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#交换结构"><span class="nav-number">3.1.</span> <span class="nav-text">交换结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#通过存储器"><span class="nav-number">3.1.1.</span> <span class="nav-text">通过存储器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过总线"><span class="nav-number">3.1.2.</span> <span class="nav-text">通过总线</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通过互连网络"><span class="nav-number">3.1.3.</span> <span class="nav-text">通过互连网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#转发和路由选择的区别"><span class="nav-number">3.1.4.</span> <span class="nav-text">转发和路由选择的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入端口和输出端口"><span class="nav-number">3.2.</span> <span class="nav-text">输入端口和输出端口</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#物理层"><span class="nav-number">3.2.1.</span> <span class="nav-text">物理层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据链路层"><span class="nav-number">3.2.2.</span> <span class="nav-text">数据链路层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#网络层"><span class="nav-number">3.2.3.</span> <span class="nav-text">网络层</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#输入端口对线路上收到分组的处理"><span class="nav-number">3.2.4.</span> <span class="nav-text">输入端口对线路上收到分组的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#输出端口对线路上收到分组的处理"><span class="nav-number">3.2.5.</span> <span class="nav-text">输出端口对线路上收到分组的处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组丢弃"><span class="nav-number">3.2.6.</span> <span class="nav-text">分组丢弃</span></a></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ray Yu</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"liaoliangdexiaohao"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
