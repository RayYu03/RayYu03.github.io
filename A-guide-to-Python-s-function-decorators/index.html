<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta name="google-site-verification" content="Y9Y8jlcM-PScY-2hDiBCdLu1omnFeLU2SiugUCAOAHY" />
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Python,decorator," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Python is rich with powerful features and expressive syntax. One of my favorites is decorators. In the context of design patterns, decorators dynamically alter the functionality of a function, method">
<meta property="og:type" content="article">
<meta property="og:title" content="A guide to Python's function decorators">
<meta property="og:url" content="http://tiierr.xyz/A-guide-to-Python-s-function-decorators/index.html">
<meta property="og:site_name" content="你今天真好看">
<meta property="og:description" content="Python is rich with powerful features and expressive syntax. One of my favorites is decorators. In the context of design patterns, decorators dynamically alter the functionality of a function, method">
<meta property="og:updated_time" content="2017-01-12T10:55:58.291Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A guide to Python's function decorators">
<meta name="twitter:description" content="Python is rich with powerful features and expressive syntax. One of my favorites is decorators. In the context of design patterns, decorators dynamically alter the functionality of a function, method">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> A guide to Python's function decorators | 你今天真好看 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">你今天真好看</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                A guide to Python's function decorators
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-10-20T18:24:25+08:00" content="2016-10-20">
              2016-10-20
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/A-guide-to-Python-s-function-decorators/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="A-guide-to-Python-s-function-decorators/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Python is rich with powerful features and expressive syntax. One of my favorites is decorators. In the context of design patterns, decorators dynamically alter the functionality of a function, method or class without having to directly use subclasses. This is ideal when you need to extend the functionality of functions that you don’t want to modify. We can implement the decorator pattern anywhere, but Python facilitates the implementation by providing much more expressive features and syntax for that.</p>
<p>In this post I will be discussing Python’s function decorators in depth, accompanied by a bunch of examples on the way to clear up the concepts. All examples are in Python 2.7 but the same concepts should apply to Python 3 with some change in the syntax.</p>
<p>Essentially, decorators work as wrappers, modifying the behavior of the code before and after a target function execution, without the need to modify the function itself, augmenting the original functionality, thus decorating it.<br><a id="more"></a></p>
<h1 id="What-you-need-to-know-about-functions"><a href="#What-you-need-to-know-about-functions" class="headerlink" title="What you need to know about functions"></a>What you need to know about functions</h1><p>Before diving in, there are some prerequisites that should be clear. In Python, functions are first class citizens, they are objects and that means we can do a lot of useful stuff with them.</p>
<h1 id="Assign-functions-to-variables"><a href="#Assign-functions-to-variables" class="headerlink" title="Assign functions to variables"></a>Assign functions to variables</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello "</span>+name</span><br><span class="line"></span><br><span class="line">greet_someone = greet</span><br><span class="line"><span class="keyword">print</span> greet_someone(<span class="string">"John"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs: hello John</span></span><br></pre></td></tr></table></figure>
<h1 id="Define-functions-inside-other-functions"><a href="#Define-functions-inside-other-functions" class="headerlink" title="Define functions inside other functions"></a>Define functions inside other functions</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_message</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello "</span></span><br><span class="line"></span><br><span class="line">    result = get_message()+name</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> greet(<span class="string">"John"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs: Hello John</span></span><br></pre></td></tr></table></figure>
<h1 id="Functions-can-be-passed-as-parameters-to-other-functions"><a href="#Functions-can-be-passed-as-parameters-to-other-functions" class="headerlink" title="Functions can be passed as parameters to other functions"></a>Functions can be passed as parameters to other functions</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">(name)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">"Hello "</span> + name</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call_func</span><span class="params">(func)</span>:</span></span><br><span class="line">    other_name = <span class="string">"John"</span></span><br><span class="line">    <span class="keyword">return</span> func(other_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> call_func(greet)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs: Hello John</span></span><br></pre></td></tr></table></figure>
<h1 id="Functions-can-return-other-functions"><a href="#Functions-can-return-other-functions" class="headerlink" title="Functions can return other functions"></a>Functions can return other functions</h1><p>In other words, functions generating other functions.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compose_greet_func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_message</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello there!"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> get_message</span><br><span class="line"></span><br><span class="line">greet = compose_greet_func()</span><br><span class="line"><span class="keyword">print</span> greet()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs: Hello there!</span></span><br></pre></td></tr></table></figure>
<h1 id="Inner-functions-have-access-to-the-enclosing-scope"><a href="#Inner-functions-have-access-to-the-enclosing-scope" class="headerlink" title="Inner functions have access to the enclosing scope"></a>Inner functions have access to the enclosing scope</h1><p>More commonly known as a closure. A very powerful pattern that we will come across while building decorators. Another thing to note, Python only allows read access to the outer scope and not assignment. Notice how we modified the example above to read a “name” argument from the enclosing scope of the inner function and return the new function.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compose_greet_func</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_message</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello there "</span>+name+<span class="string">"!"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> get_message</span><br><span class="line"></span><br><span class="line">greet = compose_greet_func(<span class="string">"John"</span>)</span><br><span class="line"><span class="keyword">print</span> greet()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs: Hello there John!</span></span><br></pre></td></tr></table></figure>
<h1 id="Composition-of-Decorators"><a href="#Composition-of-Decorators" class="headerlink" title="Composition of Decorators"></a>Composition of Decorators</h1><p>Function decorators are simply wrappers to existing functions. Putting the ideas mentioned above together, we can build a decorator. In this example let’s consider a function that wraps the string output of another function by p tags.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_text</span><span class="params">(name)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">"lorem ipsum, &#123;0&#125; dolor sit amet"</span>.format(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(name)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"&lt;p&gt;&#123;0&#125;&lt;/p&gt;"</span>.format(func(name))</span><br><span class="line">   <span class="keyword">return</span> func_wrapper</span><br><span class="line"></span><br><span class="line">my_get_text = p_decorate(get_text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> my_get_text(<span class="string">"John"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs: &lt;p&gt;lorem ipsum, John dolor sit amet&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>That was our first decorator. A function that takes another function as an argument, generates a new function, augmenting the work of the original function, and returning the generated function so we can use it anywhere. To have get_text itself be decorated by p_decorate, we just have to assign get_text to the result of p_decorate.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">get_text = p_decorate(get_text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> get_text(<span class="string">"John"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs: lorem ipsum, John dolor sit amet</span></span><br></pre></td></tr></table></figure>
<p>Another thing to notice is that our decorated function takes a name argument. All what we had to do in the decorator is to let the wrapper of get_text pass that argument.</p>
<h1 id="Python’s-Decorator-Syntax"><a href="#Python’s-Decorator-Syntax" class="headerlink" title="Python’s Decorator Syntax"></a>Python’s Decorator Syntax</h1><p>Python makes creating and using decorators a bit cleaner and nicer for the programmer through some syntactic sugar To decorate get_text we don’t have to get_text = p_decorator(get_text) There is a neat shortcut for that, which is to mention the name of the decorating function before the function to be decorated. The name of the decorator should be perpended with an @ symbol.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(name)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"&lt;p&gt;&#123;0&#125;&lt;/p&gt;"</span>.format(func(name))</span><br><span class="line">   <span class="keyword">return</span> func_wrapper</span><br><span class="line"></span><br><span class="line"><span class="meta">@p_decorate</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_text</span><span class="params">(name)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">"lorem ipsum, &#123;0&#125; dolor sit amet"</span>.format(name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> get_text(<span class="string">"John"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs &lt;p&gt;lorem ipsum, John dolor sit amet&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>Now let’s consider we wanted to decorate our get_text function by 2 other functions to wrap a div and strong tag around the string output.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(name)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"&lt;p&gt;&#123;0&#125;&lt;/p&gt;"</span>.format(func(name))</span><br><span class="line">   <span class="keyword">return</span> func_wrapper</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strong_decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(name)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;strong&gt;&#123;0&#125;&lt;/strong&gt;"</span>.format(func(name))</span><br><span class="line">    <span class="keyword">return</span> func_wrapper</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">div_decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(name)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;div&gt;&#123;0&#125;&lt;/div&gt;"</span>.format(func(name))</span><br><span class="line">    <span class="keyword">return</span> func_wrapper</span><br></pre></td></tr></table></figure>
<p>With the basic approach, decorating get_text would be along the lines of</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_text = div_decorate(p_decorate(strong_decorate(get_text)))</span><br></pre></td></tr></table></figure>
<p>With Python’s decorator syntax, same thing can be achieved with much more expressive power.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@div_decorate</span></span><br><span class="line"><span class="meta">@p_decorate</span></span><br><span class="line"><span class="meta">@strong_decorate</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_text</span><span class="params">(name)</span>:</span></span><br><span class="line">   <span class="keyword">return</span> <span class="string">"lorem ipsum, &#123;0&#125; dolor sit amet"</span>.format(name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> get_text(<span class="string">"John"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs &lt;div&gt;&lt;p&gt;&lt;strong&gt;lorem ipsum, John dolor sit amet&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;</span></span><br></pre></td></tr></table></figure>
<p>One important thing to notice here is that the order of setting our decorators matters. If the order was different in the example above, the output would have been different.</p>
<h1 id="Decorating-Methods"><a href="#Decorating-Methods" class="headerlink" title="Decorating Methods"></a>Decorating Methods</h1><p>In Python, methods are functions that expect their first parameter to be a reference to the current object. We can build decorators for methods the same way, while taking self into consideration in the wrapper function.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(self)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"&lt;p&gt;&#123;0&#125;&lt;/p&gt;"</span>.format(func(self))</span><br><span class="line">   <span class="keyword">return</span> func_wrapper</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.name = <span class="string">"John"</span></span><br><span class="line">        self.family = <span class="string">"Doe"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @p_decorate</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_fullname</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name+<span class="string">" "</span>+self.family</span><br><span class="line"></span><br><span class="line">my_person = Person()</span><br><span class="line"><span class="keyword">print</span> my_person.get_fullname()</span><br></pre></td></tr></table></figure>
<p>A much better approach would be to make our decorator useful for functions and methods alike. This can be done by putting <code>*args</code> and <code>**kwargs</code> as parameters for the wrapper, then it can accept any arbitrary number of arguments and keyword arguments.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">p_decorate</span><span class="params">(func)</span>:</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">       <span class="keyword">return</span> <span class="string">"&lt;p&gt;&#123;0&#125;&lt;/p&gt;"</span>.format(func(*args, **kwargs))</span><br><span class="line">   <span class="keyword">return</span> func_wrapper</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.name = <span class="string">"John"</span></span><br><span class="line">        self.family = <span class="string">"Doe"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @p_decorate</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_fullname</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name+<span class="string">" "</span>+self.family</span><br><span class="line"></span><br><span class="line">my_person = Person()</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> my_person.get_fullname()</span><br></pre></td></tr></table></figure>
<h1 id="Passing-arguments-to-decorators"><a href="#Passing-arguments-to-decorators" class="headerlink" title="Passing arguments to decorators"></a>Passing arguments to decorators</h1><p>Looking back at the example before the one above, you can notice how redundant the decorators in the example are. 3 decorators(div_decorate, p_decorate, strong_decorate) each with the same functionality but wrapping the string with different tags. We can definitely do much better than that. Why not have a more general implementation for one that takes the tag to wrap with as a string? Yes please!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tags</span><span class="params">(tag_name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tags_decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(name)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"&lt;&#123;0&#125;&gt;&#123;1&#125;&lt;/&#123;0&#125;&gt;"</span>.format(tag_name, func(name))</span><br><span class="line">        <span class="keyword">return</span> func_wrapper</span><br><span class="line">    <span class="keyword">return</span> tags_decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@tags("p")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_text</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello "</span>+name</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> get_text(<span class="string">"John"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Outputs &lt;p&gt;Hello John&lt;/p&gt;</span></span><br></pre></td></tr></table></figure>
<p>It took a bit more work in this case. Decorators expect to receive a function as an argument, that is why we will have to build a function that takes those extra arguments and generate our decorator on the fly. In the example above tags, is our decorator generator.</p>
<h1 id="Debugging-decorated-functions"><a href="#Debugging-decorated-functions" class="headerlink" title="Debugging decorated functions"></a>Debugging decorated functions</h1><p>At the end of the day decorators are just wrapping our functions, in case of debugging that can be problematic since the wrapper function does not carry the name, module and docstring of the original function. Based on the example above if we do:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">print</span> get_text.__name__</span><br><span class="line"><span class="comment"># Outputs func_wrapper</span></span><br></pre></td></tr></table></figure>
<p>The output was expected to be get_text yet, the attributes <code>__name__</code>, <code>__doc__</code>, and <code>__module__</code> of get_text got overridden by those of the wrapper(func_wrapper. Obviously we can re-set them within func_wrapper but Python provides a much nicer way.</p>
<h1 id="Functools-to-the-rescue"><a href="#Functools-to-the-rescue" class="headerlink" title="Functools to the rescue"></a>Functools to the rescue</h1><p>Fortunately Python (as of version 2.5) includes the functools module which contains functools.wraps. Wraps is a decorator for updating the attributes of the wrapping function(func_wrapper) to those of the original function(get_text). This is as simple as decorating func_wrapper by @wraps(func). Here is the updated example:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tags</span><span class="params">(tag_name)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tags_decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">func_wrapper</span><span class="params">(name)</span>:</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"&lt;&#123;0&#125;&gt;&#123;1&#125;&lt;/&#123;0&#125;&gt;"</span>.format(tag_name, func(name))</span><br><span class="line">        <span class="keyword">return</span> func_wrapper</span><br><span class="line">    <span class="keyword">return</span> tags_decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@tags("p")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_text</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="string">"""returns some text"""</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello "</span>+name</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> get_text.__name__ <span class="comment"># get_text</span></span><br><span class="line"><span class="keyword">print</span> get_text.__doc__ <span class="comment"># returns some text</span></span><br><span class="line"><span class="keyword">print</span> get_text.__module__ <span class="comment"># __main__</span></span><br></pre></td></tr></table></figure>
<p>You can notice from the output that the attributes of get_text are the correct ones now.</p>
<h1 id="Where-to-use-decorators"><a href="#Where-to-use-decorators" class="headerlink" title="Where to use decorators"></a>Where to use decorators</h1><p>The examples in this post are pretty simple relative to how much you can do with decorators. They can give so much power and elegance to your program. In general, decorators are ideal for extending the behavior of functions that we don’t want to modify. For a great list of useful decorators I suggest you check out the Python Decorator Library</p>
<h1 id="More-reading-resources"><a href="#More-reading-resources" class="headerlink" title="More reading resources"></a>More reading resources</h1><p>Here is a list of other resources worth checking out:</p>
<ul>
<li><a href="https://wiki.python.org/moin/PythonDecorators#What_is_a_Decorator" target="_blank" rel="external">What is a decorator?</a></li>
<li><a href="http://www.artima.com/weblogs/viewpost.jsp?thread=240808" target="_blank" rel="external">Decorators I: Introduction to Python Decorators</a></li>
<li><a href="http://www.artima.com/weblogs/viewpost.jsp?thread=240845" target="_blank" rel="external">Python Decorators II: Decorator Arguments</a></li>
<li><a href="http://www.artima.com/weblogs/viewpost.jsp?thread=241209" target="_blank" rel="external">Python Decorators III: A Decorator-Based Build System</a></li>
<li><a href="https://www.amazon.com/gp/product/B006ZHJSIM/ref=as_li_ss_tl?ie=UTF8&amp;camp=1789&amp;creative=390957&amp;creativeASIN=B006ZHJSIM&amp;linkCode=as2&amp;tag=thcosh00-20" target="_blank" rel="external">Guide to: Learning Python Decorators by Matt Harrison</a></li>
</ul>
<h1 id="Phew"><a href="#Phew" class="headerlink" title="Phew!"></a>Phew!</h1><p>That was an introduction to the concept of decorators in Python. I hope that you found this post helpful, if you have any suggestions or questions please do share them in the comments. Happy coding!</p>
<p><a href="http://thecodeship.com/patterns/guide-to-python-function-decorators/" target="_blank" rel="external">Read the original &gt;&gt;</a></p>

      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Python/" rel="tag">#Python</a>
          
            <a href="/tags/decorator/" rel="tag">#decorator</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/马拉车算法/" rel="next" title="马拉车算法">
                <i class="fa fa-chevron-left"></i> 马拉车算法
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/详解re-sub的用法/" rel="prev" title="详解re.sub的用法">
                详解re.sub的用法 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="A-guide-to-Python-s-function-decorators/"
           data-title="A guide to Python's function decorators" data-url="http://tiierr.xyz/A-guide-to-Python-s-function-decorators/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ww1.sinaimg.cn/large/647dc635jw1f37ldgc9isj20ia0jn795.jpg"
               alt="Ray Yu" />
          <p class="site-author-name" itemprop="name">Ray Yu</p>
          <p class="site-description motion-element" itemprop="description">不为无益之事，何以遣有涯至生？</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">70</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#What-you-need-to-know-about-functions"><span class="nav-number">1.</span> <span class="nav-text">What you need to know about functions</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Assign-functions-to-variables"><span class="nav-number">2.</span> <span class="nav-text">Assign functions to variables</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Define-functions-inside-other-functions"><span class="nav-number">3.</span> <span class="nav-text">Define functions inside other functions</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Functions-can-be-passed-as-parameters-to-other-functions"><span class="nav-number">4.</span> <span class="nav-text">Functions can be passed as parameters to other functions</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Functions-can-return-other-functions"><span class="nav-number">5.</span> <span class="nav-text">Functions can return other functions</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Inner-functions-have-access-to-the-enclosing-scope"><span class="nav-number">6.</span> <span class="nav-text">Inner functions have access to the enclosing scope</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Composition-of-Decorators"><span class="nav-number">7.</span> <span class="nav-text">Composition of Decorators</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Python’s-Decorator-Syntax"><span class="nav-number">8.</span> <span class="nav-text">Python’s Decorator Syntax</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Decorating-Methods"><span class="nav-number">9.</span> <span class="nav-text">Decorating Methods</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Passing-arguments-to-decorators"><span class="nav-number">10.</span> <span class="nav-text">Passing arguments to decorators</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Debugging-decorated-functions"><span class="nav-number">11.</span> <span class="nav-text">Debugging decorated functions</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Functools-to-the-rescue"><span class="nav-number">12.</span> <span class="nav-text">Functools to the rescue</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Where-to-use-decorators"><span class="nav-number">13.</span> <span class="nav-text">Where to use decorators</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#More-reading-resources"><span class="nav-number">14.</span> <span class="nav-text">More reading resources</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Phew"><span class="nav-number">15.</span> <span class="nav-text">Phew!</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ray Yu</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"liaoliangdexiaohao"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
